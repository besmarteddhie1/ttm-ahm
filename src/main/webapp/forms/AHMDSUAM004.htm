<div id="AHMDSUAM004" class="div-app" data-version="1.0">
    <div class="global_message">

    </div>
    <div id="ahmdsuam004p01" class="subpage subpage-default" data-path="Maintain Menus">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group large-font">
                    <label>Search</label>
                    <div class="input-group">
                        <input id="ahmdsuam004p01Search" type="text" class="form-control" placeholder="Search...">
                        <span class="input-group-btn">
                            <button class="btn btn-primary large-button" type="button" onclick="$('#ahmdsuam004p01SearchTable').bootstrapTable('refresh');">Search</button>

                        </span>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <table id="ahmdsuam004p01TableDelete" 
                       data-source-id="ahmdsuam004p01SearchTable"
                       data-unique-id="vid"
                       data-pagination="true"
                       data-page-size="5">
                    <thead>
                        <tr>
                            <th data-field="vapplicationId" 
                                data-sortable="true"
                                data-visible="true"
                                >Application ID</th>
                            <th data-field="vmenuId" 
                                data-sortable="true"
                                data-visible="true"
                                >Menu ID</th>
                            <th data-field="vtitle" 
                                data-sortable="true"
                                data-visible="true"
                                >Title</th>
                            <th data-field="vurl" 
                                data-sortable="true"
                                data-visible="true"
                                >URL</th>
                            <th data-field="vparent" 
                                data-sortable="true"
                                data-visible="true"
                                >Parent</th>
                            <th data-field="vaction"
                                data-formatter="actionRemoveFormatter"
                                data-events="actionEvents">Action
                            </th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="form-group-button">
                    <button id="ahmdsuam004BtnAdd" class="btn btn-primary large-button" onclick="ahmdsuam004PrepareAdd(this); return false;">Add New</button>
                    <button id="ahmdsuam004BtnDisable" class="btn btn-primary large-button" onclick="ahmdsuam004PrepareDisable(this); return false;">Disable</button>
                </div>
            </div>
        </div>
        <br/>
        <div id="table-container">
            <table id="ahmdsuam004p01SearchTable"
                   data-method="post"
                   data-url="/uam004/paging"
                   data-content-type="application/json"
                   data-data-type="json"
                   data-query-params-type="limit"
                   data-query-params="ahmdsuam004Presearch"
                   data-response-handler="loadData"
                   data-side-pagination="server"
                   data-pagination="true"
                   data-custom-action="edit"
                   data-edit-func="ahmdsuam004PrepareEdit"
                   data-checkbox-table="ahmdsuam004p01TableDelete"
                   data-unique-id="vid"
                   >
                <thead>
                    <tr>
                        <th data-field="state" 
                            data-checkbox="true"
                            data-formatter="stateFormatter"></th>
                        <th data-field="vid" 
                            data-sortable="false"
                            data-visible="false"
                            >VID</th>
                        <th data-field="vapplicationId" 
                            data-sortable="true"
                            data-visible="true"
                            >Application ID</th>
                        <th data-field="vmenuId" 
                            data-sortable="true"
                            data-visible="true"
                            >Menu ID</th>
                        <th data-field="vtitle" 
                            data-sortable="true"
                            data-visible="true"
                            >Title Menu</th>
                        <th data-field="vurl" 
                            data-sortable="true"
                            data-visible="true"
                            >URL</th>
                        <th data-field="vidparent"
                            data-visible="false"
                            >VID Parent</th>
                        <th data-field="vparent" 
                            data-sortable="true"
                            data-visible="true"
                            >Parent</th>
                        <th data-field="vicon"
                            data-sortable="false"
                            data-visible="true"
                            >Icon</th>
                        <th data-field="vstat"
                            data-visible="true"
                            >Status</th>
                        <th data-field="iver" 
                            data-sortable="false"
                            data-visible="false"
                            >IVER</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
    <div id="ahmdsuam004p02" class="subpage" data-path="Maintain Menus/Add Menu">
        <form class="form-horizontal">
            <div class="form-group large-font">
                <label for="ahmdsuam004p02ApplicationId" class="col-sm-2 control-label" >Application ID<span style="color:red"> *)  </span></label>
                <div class="col-sm-6">
                    <input id="ahmdsuam004p02ApplicationId" name="vapplicationId" class="form-control">
                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmdsuam004p02MenuId" class="col-sm-2 control-label">Menu ID<span style="color:red"> *)  </span></label>
                <div class="col-sm-6">
                    <input id="ahmdsuam004p02MenuId" name="vmenuId" class="form-control">
                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmdsuam004p02Title" class="col-sm-2 control-label">Title<span style="color:red"> *)  </span></label>
                <div class="col-sm-6">
                    <input id="ahmdsuam004p02Title" name="vtitle" class="form-control" maxlength="24">
                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmdsuam004p02Url" class="col-sm-2 control-label">URL </label>
                <div class="col-sm-6">
                    <input id="ahmdsuam004p02Url" name="vurl" class="form-control" maxlength="128">
                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmdsuam004p02Parent" class="col-sm-2 control-label">Parent </label>
                <div class="lookup-wrapper col-sm-6" >
                    <div class="input-group lookup" 
                         data-url="/uam004/getLovParent"
                         data-lookup-pre-func="ahmdsuam004LookupParent" 
                         data-columns='[{"id":"vid","name":"VID","visible":"false","sortable":"true"},
                         {"id":"vapplicationId","name":"Application ID","visible":"true","sortable":"true"},
                         {"id":"vtitle","name":"Parent","visible":"true","sortable":"true"}]'
                         data-callback='{"ahmdsuam004p02IdParent":"vid","ahmdsuam004p02Parent":"vtitle"}'
                         >
                        <input id="ahmdsuam004p02IdParent" name="vidparent2" type="hidden" data-field="vid"/>
                        <input id="ahmdsuam004p02Parent" name="vparent" class="form-control input-lookup" placeholder="LOV...." data-field-id="vid">
                        <span class="input-group-btn">
                            <button class="btn btn-default large-button btn-lookup" type="button">...</button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmdsuam004p02Iconadd" class="col-sm-2 control-label">Icon </label>
                <div class="col-sm-6">
                    <div class="input-group">
                        <input id="ahmdsuam004p02Iconadd" name="vicon" type="text" class="form-control always-disabled" disabled>
                        <span class="input-group-btn">
                            <button class="btn btn-primary large-button" type="button" onclick="ahmdsuam004PageIcon(this, 'add')" style="width: 45px!important;min-width: 45px!important;">
                                <span class="glyphicon glyphicon-new-window" style="color: white;"></span>
                            </button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmdsuam004p02Previewadd" class="col-sm-2 control-label">  </label>
                <div class="col-sm-6">
                    <div class="icon-apps preview">
                        <span id="ahmdsuam004Previewadd" style="color: white;"></span>
                    </div>
                </div>
            </div>
            <div class="col-sm-offset-2 col-sm-6 form-group-button">
                <button id="ahmdsuam004p02BtnAddNew" class="btn btn-primary large-button" style="display: none" onclick="ahmdsuam004AddNew(this);return false;">Add New</button>
                <button id="ahmdsuam004p02BtnSubmit" class="btn btn-primary large-button" onclick="ahmdsuam004AddData(this); return false;">Submit</button>
                <button id="ahmdsuam004p02BtnBack" class="btn btn-primary large-button" onclick="_fw_subpage(this, 'ahmdsuam004p01');return false;">Back</button>
            </div>
        </form>
    </div>

    <div id="ahmdsuam004p03" class="subpage" data-path="Maintain Menus/Edit Menu">
        <form class="form-horizontal">
            <input id="ahmdsuam004p03Vid" type="hidden" name="vid" data-field="vid"/>
            <input id="ahmdsuam004p03Viver" type="hidden" name="iver" data-field="iver"/>
            <div class="form-group large-font">
                <label for="ahmdsuam004p03VApplicationId" class="col-sm-2 control-label">Application ID</label>
                <div class="col-sm-6">
                    <input id="ahmdsuam004p03VApplicationId" name="vapplicationId" class="form-control" data-field="vapplicationId" disabled="disabled">
                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmduam004p03VMenuId" class="col-sm-2 control-label">Menu ID</label>
                <div class="col-sm-6">
                    <input id="ahmduam004p03VMenuId" name="vmenuId" class="form-control" data-field="vmenuId" disabled="disabled">
                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmdsuam004p03VTitle" class="col-sm-2 control-label">Title</label>
                <div class="col-sm-6">
                    <input id="ahmdsuam004p03VTitle" name="vtitle" class="form-control" data-field="vtitle" maxlength="24">
                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmdsuam004p03VUrl" class="col-sm-2 control-label">URL</label>
                <div class="col-sm-6">
                    <input id="ahmdsuam004p03VUrl" name="vurl" class="form-control" data-field="vurl" maxlength="128">
                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmdsuam004p03VParent" class="col-sm-2 control-label">Parent</label>
                <div class="lookup-wrapper col-sm-6" >
                    <div class="input-group lookup" 
                         data-url="/uam004/getLovParent"
                         data-lookup-pre-func="ahmdsuam004p03LookupParent" 
                         data-columns='[{"id":"vid","name":"VID","visible":"false","sortable":"true"},
                         {"id":"vapplicationId","name":"Application ID","visible":"true","sortable":"true"},
                         {"id":"vtitle","name":"Parent","visible":"true","sortable":"true"}]'
                         data-callback='{"ahmdsuam004p03IdParent":"vid","ahmdsuam004p03Parent":"vtitle"}'
                         >
                        <input id="ahmdsuam004p03IdParent" name="vidparent" type="hidden" data-field="vidparent" data-field-id="vid"/>
                        <input id="ahmdsuam004p03Parent" type="text" name="vparent" class="form-control input-lookup" placeholder="LOV...." data-field="vparent" data-field-id="vtitle">
                        <span class="input-group-btn"> 
                            <button class="btn btn-default large-button btn-lookup" type="button">...</button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="form-group large-font">
                <label class="col-sm-2 control-label">Status</label>
                <div class="col-sm-6">

                    <label class="radio-inline">
                        <input type="radio" name="vstat" value="AKTIF" data-field="vstat"> Aktif
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="vstat" value="TIDAK AKTIF" data-field="vstat"> Tidak Aktif
                    </label>

                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmdsuam004p02Iconedit" class="col-sm-2 control-label">Icon </label>
                <div class="col-sm-6">
                    <div class="input-group">
                        <input id="ahmdsuam004p02Iconedit" name="vicon" type="text" class="form-control always-disabled" disabled data-field="vicon">
                        <span class="input-group-btn">
                            <button class="btn btn-primary large-button" type="button" onclick="ahmdsuam004PageIcon(this, 'edit')" style="width: 45px!important;min-width: 45px!important;">
                                <span class="glyphicon glyphicon-new-window" style="color: white;"></span>
                            </button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmdsuam004p02Previewedit" class="col-sm-2 control-label">  </label>
                <div class="col-sm-6">
                    <div class="icon-apps preview">
                        <span id="ahmdsuam004Previewedit" style="color: white;"></span>
                    </div>
                </div>
            </div>
            <div class="col-sm-offset-2 col-sm-6 form-group-button">
                <button id="ahmdsuamBtnSubmitUpdate" class="btn btn-default btn-primary large-button" onclick="ahmdsuam004Update(this);return false;">Submit</button>
                <button class="btn btn-primary large-button" onclick="back(this);return false;">Back</button>
            </div>
        </form>
    </div>
    <div id="ahmdsuam004p04" class="subpage" data-path="Maintain Menus/Konfirmasi Disable Menu">
        <table 	id="ahmdsuam004p04DisableTable">

            <thead>
                <tr>
                    <th data-field="vid" 
                        data-visible="false"
                        >VID</th>
                    <th data-field="vapplicationId"
                        data-visible="true"
                        >Application ID</th>
                    <th data-field="vmenuId"
                        data-visible="true"
                        >Menu ID</th>
                    <th data-field="vtitle" 
                        data-visible="true"
                        >Title Menu</th>
                    <th data-field="vurl" 
                        data-visible="true"
                        >URL</th>
                    <th data-field="vidparent"
                        data-visible="false"
                        >VID Parent</th>
                    <th data-field="vparent"
                        data-visible="true"
                        >Parent</th>
                </tr>
            </thead>

        </table>
        <div class="form-group-button">
            <button name="btnDisable" class="btn btn-default btn-primary large-button" onclick="ahmdsuam004DisableData(this); return false;">Disable</button>
            <button class="btn btn-default btn-primary large-button" onclick="_fw_subpage(this, 'ahmdsuam004p01');return false;">Back</button>

        </div>
    </div>
    <div id="ahmdsuam004p05" class="subpage" data-path="Maintain Menus/Add Menu/Select Icon">
        <input type="hidden" id="ahmdsuam004p05FromPage" value="add"/>
        <div class="row">
            <div class="col-md-12" id="ahmdsuam004p05IconContainer">
                
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    function stateFormatter(value, row, index) {
        if (row.vstat === "TIDAK AKTIF") {
            return {
                disabled: true
            };
        }
        return value;
    }
    function ahmdsuam004Presearch(params){
        params.search = {"any": $('#ahmdsuam004p01Search').val()};
        if(params.sort == undefined){
            return{
                limit : params.limit,
                offset : params.offset,
                search : params.search
            }
        }
        return params;
    }
    function ahmdsuam004LookupParent(params){
        params.search = {"any" : $('#ahmdsuam004p02Parent').val()};
        if(params.sort == undefined){
            return{limit : params.limit,
                offset : params.offset, 
                search : params.search
            }
        }
        return params;
    }
    function ahmdsuam004p03LookupParent(params){
        params.search = {"any" : $('#ahmdsuam004p03Parent').val()};
        if(params.sort == undefined){
            return{limit : params.limit,
                offset : params.offset, 
                search : params.search
            }
        }
        return params;
    }
    function back(obj){
        _fw_subpage(obj, 'ahmdsuam004p01');
        $('#ahmdsuamNotifUpdate').css('display','none');
    }
    function ahmdsuam004PrepareAdd(obj){
        var page = $('#ahmdsuam004p02');
        $('#ahmdsuam004p02BtnSubmit').css('display','');
        $('#ahmdsuam004p02BtnAddNew').css('display','none'); 
        _fw_reset_subpage(page);
        _fw_subpage(obj, 'ahmdsuam004p02');
    }
    
    function ahmdsuam004PrepareEdit(obj, row, index){
        _fw_subpage(obj, 'ahmdsuam004p03', row);
        console.log(row.vicon);
        $('#ahmdsuam004Previewedit').attr('class', row.vicon);
    }
    function ahmdsuam004AddData(obj){
        var page = $(obj).closest('.subpage');
        _fw_validation_clear(obj);
        _fw_validation_add(obj, 'ahmdsuam004p02ApplicationId', 'required');
        _fw_validation_add(obj, 'ahmdsuam004p02MenuId', 'required');
        _fw_validation_add(obj, 'ahmdsuam004p02Title', 'required');
        if(_fw_validation_validate(obj)){
            var vo = new Object();
            vo.vapplicationId = $('input[name="vapplicationId"]', page).val();
            vo.vmenuId = $('input[name="vmenuId"]', page).val();
            vo.vtitle = $('input[name="vtitle"]', page).val();
            vo.vurl = $('input[name="vurl"]', page).val();
            vo.vparent = $('input[name="vidparent2"]', page).val();
            vo.vicon = $('input[name="vicon"]', page).val();
            //        
            _fw_post('/uam004/insert', vo, function(data){
                if(data.stat=="200"){
                    _fw_setMessage(obj, 1, data);
                    ahmdsuam004AfterAddSuccess(obj,data);
                    $('#ahmdsuam004p01SearchTable').bootstrapTable('refresh');
                } else {
                    _fw_setMessage(obj, 0, data);
                }
            });
        }
    }
    
    function ahmdsuam004Update(obj){
        var page = $(obj).closest('.subpage');
        _fw_validation_clear(obj);
        _fw_validation_add(obj, 'ahmdsuam004p03VApplicationId', '');
        _fw_validation_add(obj, 'ahmdsuam004p03VMenuId', '');
        _fw_validation_add(obj, 'ahmdsuam004p03VTitle', 'text area');
        _fw_validation_add(obj, 'ahmdsuam004p03VUrl', 'text area');
        _fw_validation_add(obj, 'ahmdsuam004p03VParent', 'text area');
        if(_fw_validation_validate(obj)){
            var vo = new Object();
            vo.vid=  $('input[name="vid"]', page).val();
            vo.iver = $('input[name="iver"]', page).val();
            vo.vapplicationId = $('input[name="vapplicationId"]', page).val();
            vo.vmenuId = $('input[name="vmenuId"]', page).val();
            vo.vtitle = $('input[name="vtitle"]', page).val();
            vo.vurl = $('input[name="vurl"]', page).val();
            vo.vidparent = $('input[name="vidparent"]', page).val();
            vo.vstat = $('input[name="vstat"]:checked', page).val();
            vo.vicon = $('input[name="vicon"]', page).val();
            _fw_post('/uam004/update', vo, function(data){
                if(data.stat=="200"){
                    _fw_setMessage(obj, 1, data);
                    $('#ahmdsuamNotifUpdate').css('display','');
                    var iver = parseInt(vo.iver)+1;
                    $('input[name="iver"]', page).val(iver);
                    ahmdsuam004AfterUpdateSuccess(obj, data);
                    $('#ahmdsuam004p01SearchTable').bootstrapTable('refresh');
                } else {
                    console.log('update-error');
                    _fw_setMessage(obj, '0', data);
                }
            });
        }
    }
    function ahmdsuam004AfterUpdateSuccess(obj,data){
        $('#ahmdsuam004p03VApplicationId').prop('disabled',true);
        $('#ahmdsuam004p03VMenuId').prop('disabled',true);
        $('#ahmdsuam004p03VTitle').prop('disabled',false);
        $('#ahmdsuam004p03VUrl').prop('disabled',false);
        $('#ahmdsuam004p03VParent').prop('disabled',false); 
        $('#ahmdsuamBtnSubmitUpdate').css('display','');     
        $('#ahmdsh1c006p02BtnReset').css('display','none');
    }
    
    function ahmdsuam004AfterAddSuccess(obj,data){
        $('#ahmdsuam004p02ApplicationId').prop('disabled',true);
        $('#ahmdsuam004p02MenuId').prop('disabled',true);
        $('#ahmdsuam004p02Title').prop('disabled',true);
        $('#ahmdsuam004p02Url').prop('disabled',true);
        $('#ahmdsuam004p02Parent').prop('disabled',true);
        $('#ahmdsuam004p02BtnAddNew').css('display',''); 
        $('#ahmdsuam004p02BtnSubmit').css('display','none');  
    }
    
    function ahmdsuam004AddNew(obj){
        _fw_validation_clear(obj);
        var page = $(obj).closest('.subpage');
        $('input, select', page).prop('disabled',false);
        _fw_reset_subpage(obj);
        $('#ahmdsuam004p02BtnSubmit').css('display','');
        $('#ahmdsuam004p02BtnAddNew').css('display','none');
    }
    
    function ahmdsuam004PrepareDisable(obj){
        var disabledRows = $('#ahmdsuam004p01TableDelete').bootstrapTable('getData');
        if(disabledRows.length > 0) {
            $('#ahmdsuam004p04DisableTable').bootstrapTable('destroy');
            $('#ahmdsuam004p04DisableTable').bootstrapTable({data:disabledRows});
        
            _fw_subpage(obj, 'ahmdsuam004p04');
        } else {
        }
    }
    function ahmdsuam004DisableData(obj){
        var disabledRows = $('#ahmdsuam004p04DisableTable').bootstrapTable('getData');
        var disabled = [];
        var vid = [];
        $.each(disabledRows, function(){
            var row = this;            
            disabled.push({'vid': row.vid});
            vid.push(row.vid);
        });
        _fw_post('/uam004/disable', disabled, function(data){
            if(data.stat=="200"){
                
                _fw_setMessage(obj, 1, data);
                $('#ahmdsuam004p01TableDelete').bootstrapTable('remove', {field: 'vid', values: vid});
                $('#ahmdsuam004p01SearchTable').bootstrapTable('refresh');
            } else {
                _fw_setMessage(obj, 0, data);
            }
        });
    }
    
    function ahmdsuam004PageIcon(obj, from){
        ahmdsuam004GenerateListIcon();
        $('#ahmdsuam004p05FromPage').val(from);
        
        var path = $(obj).closest('.subpage').data('path') + '/Select Icon';
        
        $('#ahmdsuam004p05').data('path', path);
        _fw_subpage(obj, 'ahmdsuam004p05');
        
    }
    
    function ahmdsuam004GenerateListIcon() {
        _fw_post('/uam004/geticon','',function(data){
            $.each(data.rows, function(i,v){
               $('#ahmdsuam004p05IconContainer').append(
                '<div class="icon-apps" onclick="ahmdsuam004SelectIcon(this)"><span class="'+v+'" style="color: white;"></span></div>'
                );
            });
            
        });
    }
    
    function ahmdsuam004SelectIcon(obj) {
        var className = $('span', $(obj)).attr('class');
        var from = $('#ahmdsuam004p05FromPage').val();
        $('#ahmdsuam004p02Icon'+from).val(className);
        $('#ahmdsuam004Preview'+from).attr('class', className);
        if(from == 'add') {
            _fw_subpage(obj, 'ahmdsuam004p02');
        } else {
            _fw_subpage(obj, 'ahmdsuam004p03');
        }
        
    }
</script>