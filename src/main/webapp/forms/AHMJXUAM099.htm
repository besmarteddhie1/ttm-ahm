<div id="AHMJXUAM099" class="div-app" data-version="1.0">
    <div class="global_message">

    </div>
  
  <div class="container">
  <ul class="nav nav-tabs">
    <li class="active"><a href="#menu1">Klasifikasi Dealer</a></li>
    <li><a href="#menu2">Penamaan Ring</a></li>
    <li><a href="#menu3">Penamaan Salesforce</a></li>
    <li><a href="#menu4">Aktivitas Marketing</a></li>
  </ul>

  <div class="tab-content">
    <div id="menu1" class="tab-pane fade in active">
      <h3>Klasifikasi Dealer</h3>
	  
	  <div id="ahmjxuam008p01" class="subpage subpage-default" data-path="Maintain Apps">
       
        <div class="form-group-button">
            <button class="btn btn-default btn-primary large-button" onclick="ahmjxuam008Add(this);return false;">Add</button>
            <button class="btn btn-default btn-primary large-button" onclick="ahmjxuam008DisableKonfirm(this);return false;">Update</button>
            <button class="btn btn-default btn-primary large-button" onclick="ahmjxuam008DisableKonfirm(this);return false;">Delete</button>
            
        </div>
        <br/>
        <div id="table-container">
            <table 	id="ahmjxuam008p01SearchTable"
                    data-method="post"
                    data-url="/uam008/paging"
                    data-content-type="application/json"
                    data-data-type="json"
                    data-query-params-type="limit"
                    data-query-params="ahmjxuam008Presearch"
                    data-response-handler="loadData"
                    data-side-pagination="server"
                    data-pagination="true"
                    data-custom-action="edit"
                    data-edit-func="ahmjxuam008Edit"
                    data-checkbox-table="ahmjxuam008p01TableDisable"
                    data-unique-id="vid"
                    >
                <thead>
                    <tr>
                        <th data-field="state" 
                            data-checkbox="true"
                            data-formatter="stateFormatter"></th>
                        <th data-field="vid" 
                            data-sortable="true"
                            data-visible="false"
                            >ID</th>
                        <th data-field="iver" 
                            data-sortable="true"
                            data-visible="false"
                            >Ver</th>
                        <th data-field="vname" 
                            data-sortable="true"
                            data-visible="true"
                            >Nama Application</th>
                        <th data-field="vdesc" 
                            data-sortable="true"
                            >Deskripsi Application</th>
                        <th data-field="vstat" 
                            data-sortable="true"
                            >Status Application</th>
                    </tr>
                </thead>

            </table>
        </div>


    </div>
    <div id="ahmjxuam008p02" class="subpage" data-path="Maintain Apps/Add App">
        <form class="form-horizontal">

            <div class="form-group large-font">
                <label for="ahmjxuam008p02Vname" class="col-sm-2 control-label">Nama Application <span style="color:red">*)</span></label>
                <div class="col-sm-6">
                    <input id="ahmjxuam008p02Vname" name="vname" class="form-control">
                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmjxuam008p02Vdesc" class="col-sm-2 control-label">Deskripsi Application </label>
                <div class="col-sm-6">
                    <input id="ahmjxuam008p02Vdesc" name="vdesc" class="form-control">
                </div>
            </div>
            <div class="form-group large-font">
                <label class="col-sm-2 control-label">Status</label>
                <div class="col-sm-6">

                    <label class="radio-inline">
                        <input type="radio" name="vstat" value="AKTIF" data-field="vstat"> Aktif
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="vstat" value="TIDAK AKTIF" data-field="vstat"> Tidak Aktif
                    </label>

                </div>
            </div>
            <div class="col-sm-offset-2 col-sm-6 form-group-button">
                <button name="btnAddNew" class="btn btn-default btn-primary large-button" onclick="ahmjxuam008AddNew(this);return false;" style="display: none">Add New</button>
                <button name="btnSubmit" class="btn btn-default btn-primary large-button" onclick="ahmjxuam008AddData(this);return false;">Submit</button>
                <button class="btn btn-default btn-primary large-button" onclick="_fw_reset_subpage(this)">Reset</button>
                <button class="btn btn-default btn-primary large-button" onclick="_fw_subpage(this, 'ahmjxuam008p01');return false;">Back</button>
            </div>
        </form>
    </div>
    <div id="ahmjxuam008p03" class="subpage" data-path="Maintain Apps/Edit App">
        <form class="form-horizontal">
            <input type="hidden" name="vid" data-field="vid"/>
            <input type="hidden" name="iver" data-field="iver"/>

            <div class="form-group large-font">
                <label for="ahmjxuam008p03Vname" class="col-sm-2 control-label">Nama Application <span style="color:red">*)</span></label>
                <div class="col-sm-6">
                    <input id="ahmjxuam008p03Vname" name="vname" class="form-control" data-field="vname">
                </div>
            </div>
            <div class="form-group large-font">
                <label for="ahmjxuam008p03Vdesc" class="col-sm-2 control-label">Deskripsi Application </label>
                <div class="col-sm-6">
                    <input id="ahmjxuam008p03Vdesc" name="vdesc" class="form-control" data-field="vdesc">
                </div>
            </div>
            <div class="form-group large-font">
                <label class="col-sm-2 control-label">Status</label>
                <div class="col-sm-6">

                    <label class="radio-inline">
                        <input type="radio" name="vstat" value="AKTIF" data-field="vstat"> Aktif
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="vstat" value="TIDAK AKTIF" data-field="vstat"> Tidak Aktif
                    </label>

                </div>
            </div>

            <div class="col-sm-offset-2 col-sm-6 form-group-button">
                <button class="btn btn-default btn-primary large-button" onclick="ahmjxuam008Update(this);return false;">Submit</button>
                <button class="btn btn-default btn-primary large-button" onclick="_fw_subpage(this, 'ahmjxuam008p01');return false;">Back</button>
            </div>

        </form>

    </div>
    <div id="ahmjxuam008p04" class="subpage" data-path="Maintain Apps/Konfirmasi Disable">
        <table 	id="ahmjxuam008p04DisableTable"
                >
            <thead>
                <tr>
                    <th data-field="vid" 
                        data-sortable="true"
                        data-visible="false"
                        >ID</th>
                    <th data-field="iver" 
                        data-sortable="true"
                        data-visible="false"
                        >Ver</th>
                    <th data-field="vname" 
                        data-sortable="true"
                        >Nama Application</th>
                    <th data-field="vdesc" 
                        data-sortable="true" 
                        >Deskripsi Application</th>
                </tr>
            </thead>

        </table>
        <br/>
        <div class="form-group-button">
            <button class="btn btn-default btn-primary large-button" onclick="ahmjxuam008DisableData(this)">Disable</button>
            <button class="btn btn-default btn-primary large-button" onclick="_fw_subpage(this, 'ahmjxuam008p01'); return false;">Back</button>
        </div>
    </div>


    </div>
    <div id="menu2" class="tab-pane fade">
      <h3>Penamaan Ring 1</h3>
      <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
    </div>
    <div id="menu3" class="tab-pane fade">
      <h3>Penamaan Salesforce</h3>

		<table id="tree">
			<colgroup>
			    <col width="30px">
			    <col width="50px">
			    <col width="250px">
			    <col width="50px">
			    <col width="50px">
			    <col width="30px">
			    <col width="30px">
			    <col width="50px">
		 	</colgroup>
		 	<thead>
		      <tr> <th></th> <th>#</th> <th></th> <th>Ed1</th> <th>Ed2</th> <th>Rb1</th> <th>Rb2</th> <th>Cb</th></tr>
		    </thead>
		    <tbody>
		    </tbody>
		</table>
		
		
    </div>
    <div id="menu4" class="tab-pane fade">
      <h3>Aktivitas Marketing</h3>
      <p>Eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
    </div>
  </div>
</div>
  
  </div>
  
<script type="text/javascript">

	$(document).ready(function(){
	    $(".nav-tabs a").click(function(){
	        $(this).tab('show');
	    });

	    var xsource= [
	    	          {title: "Parent 1", key: "1", children: [
	    	                       	    	                {title: "Node 1.1", key: "5"},
	    	                       	    	                {title: "Node 1.2", key: "6"}
	    	                       	    	           ]},
	    	                       	    	          {title: "Parent 2", key: "2", children: [
	    	                       	    	            {title: "Node 2.1", key: "3"},
	    	                       	    	            {title: "Node 2.2", key: "4"}
	    	                       	    	          ]}
	    	                       	    	        ];

	    //treeview
	     var tree = $("#tree").fancytree({
	    	 checkbox: true,
	    	    titlesTabbable: true,     // Add all node titles to TAB chain
	    	    quicksearch: true,        // Jump to nodes when pressing first character
	    	    source: xsource,

	    	    // extensions: ["edit", "table", "gridnav"],
	    	    extensions: ["edit", "dnd", "table", "gridnav"],

	    	    dnd: {
	    	      preventVoidMoves: true,
	    	      preventRecursiveMoves: true,
	    	      autoExpandMS: 400,
	    	      dragStart: function(node, data) {
	    	        return true;
	    	      },
	    	      dragEnter: function(node, data) {
	    	        // return ["before", "after"];
	    	        return true;
	    	      },
	    	      dragDrop: function(node, data) {
	    	        data.otherNode.moveTo(node, data.hitMode);
	    	      }
	    	    },
	    	    edit: {
	    	      triggerStart: ["f2", "shift+click", "mac+enter"],
	    	      close: function(event, data) {
	    	        if( data.save && data.isNew ){
	    	          // Quick-enter: add new nodes until we hit [enter] on an empty title
	    	          $("#tree").trigger("nodeCommand", {cmd: "addSibling"});
	    	        }
	    	      }
	    	    },
	    	    table: {
	    	      indentation: 20,
	    	      nodeColumnIdx: 2,
	    	      checkboxColumnIdx: 0
	    	    },
	    	    gridnav: {
	    	      autofocusInput: false,
	    	      handleCursorKeys: true
	    	    },

	    	    lazyLoad: function(event, data) {
	    	      data.result = {url: "../demo/ajax-sub2.json"};
	    	    },
	    	    renderColumns: function(event, data) {
	    	      var node = data.node,
	    	        $select = $("<select />"),
	    	        $tdList = $(node.tr).find(">td");

	    	      // (Index #0 is rendered by fancytree by adding the checkbox)
	    	      $tdList.eq(1).text(node.getIndexHier()).addClass("alignRight");
	    	      // Index #2 is rendered by fancytree, but we make the title cell
	    	      // span the remaining columns if it is a folder:
	    	      if( node.isFolder() ) {
	    	        $tdList.eq(2)
	    	          .prop("colspan", 6)
	    	          .nextAll().remove();
	    	      }
	    	      $tdList.eq(3).html("<input type='input' value='" + "" + "'>");
	    	      $tdList.eq(4).html("<input type='input' value='" + "" + "'>");
	    	      $tdList.eq(5).html("<input type='checkbox' value='" + "" + "'>");
	    	      $tdList.eq(6).html("<input type='checkbox' value='" + "" + "'>");
	    	      $("<option />", {text: "a", value: "a"}).appendTo($select);
	    	      $("<option />", {text: "b"}).appendTo($select);
	    	      $tdList.eq(7).html($select);
	    	    }
	    	  }).on("nodeCommand", function(event, data){
	    	    // Custom event handler that is triggered by keydown-handler and
	    	    // context menu:
	    	    var refNode, moveMode,
	    	      tree = $(this).fancytree("getTree"),
	    	      node = tree.getActiveNode();

	    	    switch( data.cmd ) {
	    	    case "moveUp":
	    	      refNode = node.getPrevSibling();
	    	      if( refNode ) {
	    	        node.moveTo(refNode, "before");
	    	        node.setActive();
	    	      }
	    	      break;
	    	    case "moveDown":
	    	      refNode = node.getNextSibling();
	    	      if( refNode ) {
	    	        node.moveTo(refNode, "after");
	    	        node.setActive();
	    	      }
	    	      break;
	    	    case "indent":
	    	      refNode = node.getPrevSibling();
	    	      if( refNode ) {
	    	        node.moveTo(refNode, "child");
	    	        refNode.setExpanded();
	    	        node.setActive();
	    	      }
	    	      break;
	    	    case "outdent":
	    	      if( !node.isTopLevel() ) {
	    	        node.moveTo(node.getParent(), "after");
	    	        node.setActive();
	    	      }
	    	      break;
	    	    case "rename":
	    	      node.editStart();
	    	      break;
	    	    case "remove":
	    	      refNode = node.getNextSibling() || node.getPrevSibling() || node.getParent();
	    	      node.remove();
	    	      if( refNode ) {
	    	        refNode.setActive();
	    	      }
	    	      break;
	    	    case "addChild":
	    	      node.editCreateNode("child", "");
	    	      break;
	    	    case "addSibling":
	    	      node.editCreateNode("after", "");
	    	      break;
	    	    case "cut":
	    	      CLIPBOARD = {mode: data.cmd, data: node};
	    	      break;
	    	    case "copy":
	    	      CLIPBOARD = {
	    	        mode: data.cmd,
	    	        data: node.toDict(function(n){
	    	          delete n.key;
	    	        })
	    	      };
	    	      break;
	    	    case "clear":
	    	      CLIPBOARD = null;
	    	      break;
	    	    case "paste":
	    	      if( CLIPBOARD.mode === "cut" ) {
	    	        // refNode = node.getPrevSibling();
	    	        CLIPBOARD.data.moveTo(node, "child");
	    	        CLIPBOARD.data.setActive();
	    	      } else if( CLIPBOARD.mode === "copy" ) {
	    	        node.addChildren(CLIPBOARD.data).setActive();
	    	      }
	    	      break;
	    	    default:
	    	      alert("Unhandled command: " + data.cmd);
	    	      return;
	    	    }

	    	  // }).on("click dblclick", function(e){
	    	  //   console.log( e, $.ui.fancytree.eventToString(e) );

	    	  }).on("keydown", function(e){
	    	    var cmd = null;

	    	    // console.log(e.type, $.ui.fancytree.eventToString(e));
	    	    switch( $.ui.fancytree.eventToString(e) ) {
	    	    case "ctrl+shift+n":
	    	    case "meta+shift+n": // mac: cmd+shift+n
	    	      cmd = "addChild";
	    	      break;
	    	    case "ctrl+c":
	    	    case "meta+c": // mac
	    	      cmd = "copy";
	    	      break;
	    	    case "ctrl+v":
	    	    case "meta+v": // mac
	    	      cmd = "paste";
	    	      break;
	    	    case "ctrl+x":
	    	    case "meta+x": // mac
	    	      cmd = "cut";
	    	      break;
	    	    case "ctrl+n":
	    	    case "meta+n": // mac
	    	      cmd = "addSibling";
	    	      break;
	    	    case "del":
	    	    case "meta+backspace": // mac
	    	      cmd = "remove";
	    	      break;
	    	    // case "f2":  // already triggered by ext-edit pluging
	    	    //   cmd = "rename";
	    	    //   break;
	    	    case "ctrl+up":
	    	      cmd = "moveUp";
	    	      break;
	    	    case "ctrl+down":
	    	      cmd = "moveDown";
	    	      break;
	    	    case "ctrl+right":
	    	    case "ctrl+shift+right": // mac
	    	      cmd = "indent";
	    	      break;
	    	    case "ctrl+left":
	    	    case "ctrl+shift+left": // mac
	    	      cmd = "outdent";
	    	    }
	    	    if( cmd ){
	    	      $(this).trigger("nodeCommand", {cmd: cmd});
	    	      // e.preventDefault();
	    	      // e.stopPropagation();
	    	      return false;
	    	    }
	    	  });

	    	  /*
	    	   * Tooltips
	    	   */
	    	  $("#tree").tooltip({
	    	    content: function () {
	    	      return $(this).attr("title");
	    	    }
	    	  });

	    	  /*
	    	   * Context menu (https://github.com/mar10/jquery-ui-contextmenu)
	    	   */
	    	  $("#tree").contextmenu({
	    	    delegate: "span.fancytree-node",
	    	    menu: [
	    	      {title: "Edit <kbd>[F2]</kbd>", cmd: "rename", uiIcon: "ui-icon-pencil" },
	    	      {title: "Delete <kbd>[Del]</kbd>", cmd: "remove", uiIcon: "ui-icon-trash" },
	    	      {title: "----"},
	    	      {title: "New sibling <kbd>[Ctrl+N]</kbd>", cmd: "addSibling", uiIcon: "ui-icon-plus" },
	    	      {title: "New child <kbd>[Ctrl+Shift+N]</kbd>", cmd: "addChild", uiIcon: "ui-icon-arrowreturn-1-e" },
	    	      {title: "----"},
	    	      {title: "Cut <kbd>Ctrl+X</kbd>", cmd: "cut", uiIcon: "ui-icon-scissors"},
	    	      {title: "Copy <kbd>Ctrl-C</kbd>", cmd: "copy", uiIcon: "ui-icon-copy"},
	    	      {title: "Paste as child<kbd>Ctrl+V</kbd>", cmd: "paste", uiIcon: "ui-icon-clipboard", disabled: true }
	    	      ],
	    	    beforeOpen: function(event, ui) {
	    	      var node = $.ui.fancytree.getNode(ui.target);
	    	      $("#tree").contextmenu("enableEntry", "paste", !!CLIPBOARD);
	    	      node.setActive();
	    	    },
	    	    select: function(event, ui) {
	    	      var that = this;
	    	      // delay the event, so the menu can close and the click event does
	    	      // not interfere with the edit control
	    	      setTimeout(function(){
	    	        $(that).trigger("nodeCommand", {cmd: ui.cmd});
	    	      }, 100);
	    	    }
	    	  });
	    	
		  /*  var tree = $("#tree").fancytree("getTree"),
		      activeNode = tree.getActiveNode();
	
		  // Sort children of active node:
		  activeNode.sortChildren();
		  // Expand all tree nodes
		  tree.visit(function(node){
		    node.setExpanded(true);
		  });
		  // Append a new child node
		  activeNode.addChildren({
		    title: "Document using a custom icon",
		    icon: "customdoc1.gif"
		  });	 */	    

	});

    function stateFormatter(value, row, index) {
        if (row.vdesc === "TIDAK AKTIF") {
            return {
                disabled: true
            };
        }
        return value;
    }

    
    
    function ahmjxuam008Presearch(params){
        params.search = {"any": $('#ahmjxuam008p01Search').val()};
        if(params.sort == undefined){
            return{
                limit : params.limit,
                offset : params.offset,
                search : params.search
            }
        }
        return params;
    }
    function ahmjxuam008Add(obj){
        var page = $('#ahmjxuam008p02');
        $('input, select', page).prop('disabled',false);
        _fw_reset_subpage(page);
        _fw_subpage(obj, 'ahmjxuam008p02');
        $('button[name="btnAddNew"]', page).hide();
        $('button[name="btnSubmit"]', page).show();
    }
    function ahmjxuam008Edit(obj, row, index){
        _fw_subpage(obj, 'ahmjxuam008p03', row);
    }
    
    function ahmjxuam008DisableKonfirm(obj){
        var disabledRows = $('#ahmjxuam008p01TableDisable').bootstrapTable('getData');
        if(disabledRows.length > 0) {
            $('#ahmjxuam008p04DisableTable').bootstrapTable('destroy');
            $('#ahmjxuam008p04DisableTable').bootstrapTable({data:disabledRows});
        
            _fw_subpage(obj, 'ahmjxuam008p04');
        } else {
            alert('no data selected');
        }
    }
    
    function ahmjxuam008DisableData(obj){
        var disabledRows = $('#ahmjxuam008p04DisableTable').bootstrapTable('getData');
        var disabled = [];
        var vid = [];
        var listVo = [];
        $.each(disabledRows, function(){
            var row = this;
            
            disabled.push({'vid': row.vid});
            vid.push(row.vid);
        });
        _fw_post('/uam008/disable', disabled, function(data){
            if(data.stat=="200"){
                _fw_setMessage(obj, 1, data);
                $('#ahmjxuam008p01TableDisable').bootstrapTable('remove', {field: 'vid', values: vid});
                $('#ahmjxuam008p01SearchTable').bootstrapTable('refresh');
            } else {
                _fw_setMessage(obj, 0, data);
            }
        });
    }
    function ahmjxuam008AddData(obj){
        var page = $(obj).closest('.subpage');
        _fw_validation_clear(obj);
        _fw_validation_add(obj, 'ahmjxuam008p02Vname', 'required');
        _fw_validation_add(obj, 'ahmjxuam008p02Vdesc', 'required');
        if(_fw_validation_validate(obj)){
            var vo = new Object();
            vo.vname = $('input[name="vname"]', page).val();
            vo.vdesc = $('input[name="vdesc"]', page).val();
        
            _fw_post('/uam008/insert', vo, function(data){
                if(data.stat=="200"){
                    //_fw_subpage(obj, 'ahmdsh1c008p01');
                    $('input, select', page).prop('disabled',true);
                    $('button[name="btnAddNew"]', page).show();
                    $('button[name="btnSubmit"]', page).hide();
                    _fw_setMessage(obj, 1, data);
                    $('#ahmjxuam008p01SearchTable').bootstrapTable('refresh');
                } else {
                    _fw_setMessage(obj, 0, data);
                }
            });
        }
    }

    function ahmjxuam008AddNew(obj){
        _fw_validation_clear(obj);
        var page = $(obj).closest('.subpage');
        $('input, select', page).prop('disabled',false);
        _fw_reset_subpage(obj);
        $('button[name="btnAddNew"]', page).hide();
        $('button[name="btnSubmit"]', page).show();
    }

    function ahmjxuam008Update(obj){
        var page = $(obj).closest('.subpage');
        _fw_validation_clear(obj);
        _fw_validation_add(obj, 'ahmjxuam008p03Vname', 'required');
        _fw_validation_add(obj, 'ahmjxuam008p03Vdesc', 'text area');
        if(_fw_validation_validate(obj)){
            var vo = new Object();
            vo.vid = $('input[name="vid"]', page).val();
            vo.iver = $('input[name="iver"]', page).val();
            vo.vname = $('input[name="vname"]', page).val();
            vo.vdesc = $('input[name="vdesc"]', page).val();
            vo.vstat = $('input[name="vstat"]:checked', page).val();
            _fw_post('/uam008/update', vo, function(data){
                if(data.stat=="200"){
                
                    //_fw_subpage(obj, 'ahmdsh1c008p01');
                    _fw_setMessage(obj, 1, data);
                    var iver = parseInt(vo.iver)+1;
                    $('input[name="iver"]', page).val(iver);
                    $('#ahmjxuam008p01SearchTable').bootstrapTable('refresh');
                } else {
                    //_fw_setMessage(obj, 0, data);
                    console.log('update-error');
                    _fw_setMessage(obj, '0', data);
                
                }
            });
        }
    }




</script>


