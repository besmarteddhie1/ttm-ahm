<div id="AHMJXTTM007" class="div-app" data-version="1.0">
	<div class="global_message">

	</div>

	<div class="row">
		<div class="col-md-12">
			<div class="tab-content">
				<div id="menu1" class="tab-pane fade in active ">

					<div class="col-md-12">
						<div id="ahmjxttm007p01" class="subpage subpage-default" data-path="">
							<div class="row hidden" >
								
								<div class="col-md-6" >
									<table id="ahmjxttm007TableDisable" 
									data-source-id="ahmjxttm007Table" 
									data-unique-id="idCategory"
									data-pagination="true"
									data-page-size="5">
									<thead>
									</thead>
								</table>
							</div>
						</div>
						<div class="form-group-button pull-left">
							<select id="ahmjxttm007p01Kategori" class="form-control"></select>
						</div>
						<div class="form-group-button pull-right">
							<button class="btn btn-default btn-primary large-button" onclick="ahmjxttm007Add(this);return false;">Download Format Excel</button>
							<button class="btn btn-default btn-primary large-button" onclick="ahmjxttm007Edit(this);return false;">Upload Data Excel</button>
							<button class="btn btn-default btn-primary large-button" onclick="ahmjxttm007Add(this);return false;">Tambah</button>
							<button class="btn btn-default btn-primary large-button" onclick="ahmjxttm007Edit(this);return false;">Ubah</button>
							<button class="btn btn-default btn-primary large-button" onclick="ahmjxttm007Edit(this);return false;">Hapus</button>
						</div>
						
						<div id="table-container">
							<table id="ahmjxttm007Table"
							data-method="get"
							data-url="/api/ttm001/dc"
							data-content-type="application/json"
							data-data-type="json"
							data-pagination="true"
							data-page-size="10"
							data-page-list="[10,25,50]"
							data-custom-action="edit, delete"
							data-checkbox-table="ahmjxttm007TableDisable"
							data-unique-id="idCategory">
							<thead>
								<tr>
									<th data-field="state" data-checkbox="true" data-formatter="stateFormatter"></th>
									<th data-field="idCategory" data-sortable="true" data-visible="false">ID</th>
									<th data-field="iver" data-sortable="true" data-visible="true">Kabupaten</th>
									<th data-field="description" data-sortable="true" data-visible="true">Kecamatan</th>
									<th data-field="salesQty" data-sortable="true" data-visible="true">Keluarahan</th>
									<th data-field="salesQty" data-sortable="true" data-visible="true">Nama Lokasi</th>
								</tr>
							</thead>
							
						</table>
					</div>
				</div>
				<div id="ahmjxttm007p02" class="subpage" data-path="">
					<form class="form-horizontal">
						<div class="form-group-button">
							<button name="btnAddNew" class="btn btn-default btn-primary large-button" onclick="ahmjxttm007AddNew(this);return false;" style="display: none">Simpan</button>
							<button name="btnSubmit" class="btn btn-default btn-primary large-button" onclick="ahmjxttm007AddData(this);_subpage(this, 'ahmjxttm007p01');return false;">Simpan</button>
							<button class="btn btn-default btn-primary large-button" onclick="_subpage(this, 'ahmjxttm007p01');return false;">Batal</button>
						</div>
						<input id="ahmjxttm007p02id" type="hidden" name="id" >
						
						<div class="form-group large-font">
							<label for="ahmjxttm007p02Kategori" class="col-sm-3 control-label">Kategori <span style="color:red">*)</span></label>
							<div class="col-sm-6">
								<select id="ahmjxttm007p02Kategori" name="kategori" class="form-control">
									<option>Pasar</option>
									<option>Pasar 1</option>
									<option>Pasar 2</option>
								</select>
							</div>
						</div>
						
						<div class="form-group large-font">
							<label for="ahmjxttm007p02Provinsi" class="col-sm-3 control-label">Provinsi <span style="color:red">*)</span></label>
							<div class="col-sm-6">
								<select id="ahmjxttm007p02Provinsi" name="provinsi" class="form-control">
									<option>DKI Jakarta 1</option>
									<option>DKI Jakarta 2</option>
									<option>DKI Jakarta 3</option>
								</select>
							</div>
						</div>
						
						<div class="form-group large-font">
							<label for="ahmjxttm007p02Kabupaten" class="col-sm-3 control-label">Kabupaten <span style="color:red">*)</span></label>
							<div class="col-sm-6">
								<select id="ahmjxttm007p02Kabupaten" name="kabupaten" class="form-control">
									<option>Pilih Kabupaten</option>
								</select>
							</div>
						</div>
						
						<div class="form-group large-font">
							<label for="name="category" " class="col-sm-3 control-label">Kecamatan <span style="color:red">*)</span></label>
							<div class="col-sm-6">
								<select id="ahmjxttm007p02Kecamatan" class="form-control" name="kecamatan">
									<option>Pilih Kecamatan</option>
								</select>
							</div>
						</div>
						
						<div class="form-group large-font">
							<label for="ahmjxttm007p02Kelurahan" class="col-sm-3 control-label">Kelurahan <span style="color:red">*)</span></label>
							<div class="col-sm-6">
								<select id="ahmjxttm007p02Kelurahan" class="form-control" name="kelurahan">
									<option>Pilih Kelurahan</option>
								</select>
							</div>
						</div>
						
						<div class="form-group large-font">
							<label for="ahmjxttm007p02Lokasi" class="col-sm-3 control-label">Nama Lokasi <span style="color:red">*)</span></label>
							<div class="col-sm-6">
								<input id="ahmjxttm007p02Lokasi" class="form-control" name="lokasi">
							</div>
						</div>
						
						
					</form>
				</div>
				<div id="ahmjxttm007p03" class="subpage" data-path="">
					<form class="form-horizontal">
						<div class="form-group-button">
							<button name="btnAddNew" class="btn btn-default btn-primary large-button" onclick="ahmjxttm007AddNew(this);return false;" style="display: none">Simpan</button>
							<button name="btnSubmit" class="btn btn-default btn-primary large-button" onclick="ahmjxttm007AddData(this);_subpage(this, 'ahmjxttm007p01');return false;">Simpan</button>
							<button class="btn btn-default btn-primary large-button" onclick="_subpage(this, 'ahmjxttm007p01');return false;">Batal</button>
						</div>
						<input id="ahmjxttm007p02id" type="hidden" name="id" >
						<div class="form-group large-font">
							<label for="ahmjxttm007p02Kategori" class="col-sm-3 control-label">Kategori <span style="color:red">*)</span></label>
							<div class="col-sm-6">
								<select id="ahmjxttm007p02Kategori" name="kategori" class="form-control">
									<option>Pasar</option>
									<option>Pasar 1</option>
									<option>Pasar 2</option>
								</select>
							</div>
						</div>
						
						<div class="form-group large-font">
							<label for="ahmjxttm007p02Provinsi" class="col-sm-3 control-label">Provinsi <span style="color:red">*)</span></label>
							<div class="col-sm-6">
								<select id="ahmjxttm007p02Provinsi" name="provinsi" class="form-control">
									<option>DKI Jakarta 1</option>
									<option>DKI Jakarta 2</option>
									<option>DKI Jakarta 3</option>
								</select>
							</div>
						</div>
						
						<div class="form-group large-font">
							<label for="ahmjxttm007p02Kabupaten" class="col-sm-3 control-label">Kabupaten <span style="color:red">*)</span></label>
							<div class="col-sm-6">
								<select id="ahmjxttm007p02Kabupaten" name="kabupaten" class="form-control">
									<option>Pilih Kabupaten</option>
								</select>
							</div>
						</div>
						
						<div class="form-group large-font">
							<label for="name="category" " class="col-sm-3 control-label">Kecamatan <span style="color:red">*)</span></label>
							<div class="col-sm-6">
								<select id="ahmjxttm007p02Kecamatan" class="form-control" name="kecamatan">
									<option>Pilih Kecamatan</option>
								</select>
							</div>
						</div>
						
						<div class="form-group large-font">
							<label for="ahmjxttm007p02Kelurahan" class="col-sm-3 control-label">Kelurahan <span style="color:red">*)</span></label>
							<div class="col-sm-6">
								<select id="ahmjxttm007p02Kelurahan" class="form-control" name="kelurahan">
									<option>Pilih Kelurahan</option>
								</select>
							</div>
						</div>
						
						<div class="form-group large-font">
							<label for="ahmjxttm007p02Lokasi" class="col-sm-3 control-label">Nama Lokasi <span style="color:red">*)</span></label>
							<div class="col-sm-6">
								<input id="ahmjxttm007p02Lokasi" class="form-control" name="lokasi">
							</div>
						</div>
						
					</form>

				</div>
				<div id="map" class="smallmap"></div>
				
			</div>
			
			
			
		</div>
	</div>
</div> <!-- end of tab-content -->
</div>
</div>

<script type="text/javascript">

	$(document).ready(function() {
		ahmjxttm007GetFacilityType(this);
	});

	function _subpage(obj, id, row){
		_fw_setMessage(obj);
		var parent = $(obj).closest('.menu*');
		console.log(parent);
		if(parent.html() == undefined) {
			parent = $(obj).closest('.tab-pane');
		}
		$('.subpage.subpage-default', parent).removeClass('subpage-default');
		var targetSubpage = $('#'+id);
		_fw_validation_clear(targetSubpage);
		$(targetSubpage).addClass('subpage-default');
		
		automaticFill(row, targetSubpage);
		
	}

	var xdata;
	//var SOURCE= CLIPBOARD = null;
	var SOURCE = [
	{title: "DKI Jakarta",id:"1",children: [
	{title: "Jakarta Pusat",id:"2",children:[
	{title: "Senen",id:"3",lat:"-42.088534",lon:"146.596076"},
	{title: "Kramat",id:"8",lat:"-42.984253",lon:"146.96765"},
	{title: "Gunung Sahari",id:"9",lat:"-42.660900",lon:"146.1096633"},
	{title: "Menteng",id:"10",lat:"-41.088534",lon:"146.596076"},			                             		                                 		      
	]},
	{title: "Jakarta Timur",id:"11"},
	{title: "Jakarta Utara",id:"12"},
	{title: "Jakarta Selatan",id:"13"},
	{title: "Jakarta Barat",id:"14"},		                               		        		     
	]},
	{title: "Jawa Barat",id:"4"},
	{title: "Jawa Timur",id:"5"},
	{title: "Banten",id:"6"},
	{title: "DI Yogyakarta",id:"7"}
	
	],
	CLIPBOARD = null;

	
	$(function(){
		$(".nav-tabs a").click(function(){
			$(this).tab('show');
		});

		/* $.ajax({type: "GET",url: baseURL+"/api/ttm001/sf",contentType: "application/json",
				dataType: 'json',async: false,data: JSON.stringify()})
			.done(function(data){
				var parsed = JSON.parse(JSON.stringify(data), function(k, v) {
					if (k === "description") 
						this.title = v;
					else if (k === "categories")
						this.children = v;
					else
						return v;}
				);
				x = parsed;
				console.log("source==>",SOURCE);
			}) ;  */
	
		$("#tree6").fancytree({
			source: SOURCE,
			activate: function(event, data) {
				var node = data.node;
				
			},
		});
	});
	
	function ahmjxttm007GetFacilityType(obj){
		console.log("------> TEST");
		var vo = new Object();
		$.ajax
		({
			type: "GET",
			url: "/ahmjxdsh000/api/ttm001/loc",
			contentType: "application/json",
			dataType: 'json',
			success:function(data){
				console.log(data);
				//$("#ahmjxttm007p01Kategori")
				$.each(data, function(i, value) {
		            $('#ahmjxttm007p01Kategori').append($('<option>').text(value.category).attr('value', value.category));
		        });
			},
		});
	}

	function ahmjxttm007Add(obj){
		var page = $('#ahmjxttm007p02');
		$('input, select', page).prop('disabled',false);
		_fw_reset_subpage(page);
		_subpage(obj, 'ahmjxttm007p02');
		$('button[name="btnAddNew"]', page).hide();
		$('button[name="btnSubmit"]', page).show();
	}

	function ahmjxttm007AddData(obj){
		var page = $(obj).closest('.subpage');
		_fw_validation_clear(obj);
		_fw_validation_add(obj, 'ahmjxttm007p02Description', 'required');
		_fw_validation_add(obj, 'ahmjxttm007p02SalesQty', 'required');

		if(_fw_validation_validate(obj)){
			var vo = new Object();
			//vo.idCategoryType = $('input[name="idCategoryType"]', page).val();
			//vo.idParentCategory = $('input[name="idParentCategory"]', page).val();
			vo.idCategoryType = 101;
			vo.idParentCategory = 0;
			vo.description = $('input[id="ahmjxttm007p02Description"]', page).val();
			vo.salesQty = $('input[id="ahmjxttm007p02SalesQty"]', page).val();
			
			console.log(vo);

			$.ajax
			({
				type: "POST",
				url: "/ahmjxdsh000/api/partycategory",
				contentType: "application/json",
				dataType: 'json',
				data: JSON.stringify(vo),
				success:function(data){
					console.log(data);
					_fw_setMessage(obj,1,"Success");
					$('#ahmjxttm007Table').bootstrapTable('refresh');
				},
			});
		}
	}

	/* function menu1Edit(obj, row, index){
		_subpage(obj, 'menu1p03', row);
	} */
	
	function ahmjxttm007Edit(obj){
		
		var editedRows = $('#ahmjxttm007TableDisable').bootstrapTable('getData');
		console.log("edited==>",editedRows);
		if (editedRows.length == 1)
		{
			_subpage(obj,'ahmjxttm007p03', editedRows[0]);
			
		}
		else
			alert("Pilih salah satu item jika ingin mengubah.");
	}

	function ahmjxttm007EditData(obj)
	{
		var page = $(obj).closest('.subpage');
		_fw_validation_clear(obj);
		_fw_validation_add(obj, 'ahmjxttm007p03Description', 'required');
		_fw_validation_add(obj, 'ahmjxttm007p03SalesQty', 'required');
		if(_fw_validation_validate(obj)){
			var vo = new Object();
				//vo.idCategoryType = $('input[name="idCategoryType"]', page).val();
				//vo.idParentCategory = $('input[name="idParentCategory"]', page).val();
				vo.idCategory = $('input[name="idCategory"]', page).val();
				vo.idCategoryType = 101;
				vo.idParentCategory = 0;
				vo.description = $('input[id="ahmjxttm007p03Description"]', page).val();
				vo.salesQty = $('input[id="ahmjxttm007p03SalesQty"]', page).val();

				$.ajax
				({
					type: "PUT",
					url: "/ahmjxdsh000/api/partycategory/" + vo.idCategory,
					contentType: "application/json",
					dataType: 'json',
					data: JSON.stringify(vo),
					success:function(data){
						_fw_setMessage(obj,1,"Success");
						$('#ahmjxttm007Table').bootstrapTable('refresh');
					},
				});
			} 
		}

		

		
		

	</script>
